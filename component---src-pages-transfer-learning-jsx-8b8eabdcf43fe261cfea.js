/*! For license information please see component---src-pages-transfer-learning-jsx-8b8eabdcf43fe261cfea.js.LICENSE.txt */
"use strict";(self.webpackChunkgatsby_starter_hello_world=self.webpackChunkgatsby_starter_hello_world||[]).push([[73],{3267:function(t,e,a){a.r(e),a.d(e,{default:function(){return d}});var s=a(1721),r=a(7294),n=a(1079),l=(a(3603),a(2888)),i=a(784),o=a(8081);function c(t,e,a,s){return new(a||(a=Promise))((function(r,n){function l(t){try{o(s.next(t))}catch(e){n(e)}}function i(t){try{o(s.throw(t))}catch(e){n(e)}}function o(t){var e;t.done?r(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(l,i)}o((s=s.apply(t,e||[])).next())}))}function u(t,e){var a,s,r,n,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function i(n){return function(i){return function(n){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,s&&(r=2&n[0]?s.return:n[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,n[1])).done)return r;switch(s=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,s=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(!(r=l.trys,(r=r.length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){l=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){l.label=n[1];break}if(6===n[0]&&l.label<r[1]){l.label=r[1],r=n;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(n);break}r[2]&&l.ops.pop(),l.trys.pop();continue}n=e.call(t,l)}catch(i){n=[6,i],s=0}finally{a=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,i])}}}function p(t,e){for(var a=[],s=0;s<t.length;s++)a.push({value:t[s],index:s});a.sort((function(t,e){return e.value-t.value}));var r=new Float32Array(e),n=new Int32Array(e);for(s=0;s<e;s++)r[s]=a[s].value,n[s]=a[s].index;return{values:r,indices:n}}var h=function(){function t(){this.classDatasetMatrices={},this.classExampleCount={},this.labelToClassId={},this.nextClassId=0}return t.prototype.addExample=function(t,e){var a=this;if(null==this.exampleShape&&(this.exampleShape=t.shape),!o.util.arraysEqual(this.exampleShape,t.shape))throw new Error("Example shape provided, ".concat(t.shape," does not match ")+"previously provided example shapes ".concat(this.exampleShape,"."));this.clearTrainDatasetMatrix(),e in this.labelToClassId||(this.labelToClassId[e]=this.nextClassId++),(0,o.tidy)((function(){var s=a.normalizeVectorToUnitLength((0,o.reshape)(t,[t.size])),r=s.shape[0];if(null==a.classDatasetMatrices[e])a.classDatasetMatrices[e]=(0,o.reshape)(s,[1,r]);else{var n=(0,o.concat)([(0,o.reshape)(a.classDatasetMatrices[e],[a.classExampleCount[e],r]),(0,o.reshape)(s,[1,r])],0);a.classDatasetMatrices[e].dispose(),a.classDatasetMatrices[e]=n}(0,o.keep)(a.classDatasetMatrices[e]),null==a.classExampleCount[e]&&(a.classExampleCount[e]=0),a.classExampleCount[e]++}))},t.prototype.similarities=function(t){var e=this;return(0,o.tidy)((function(){var a,s,r=e.normalizeVectorToUnitLength((0,o.reshape)(t,[t.size])),n=r.shape[0];if(null==e.trainDatasetMatrix){var l=null;for(var i in e.classDatasetMatrices)a=l,s=e.classDatasetMatrices[i],l=null==a&&null==s?null:null==a?s.clone():null===s?a.clone():(0,o.concat)([a,s],0);e.trainDatasetMatrix=l}if(null==e.trainDatasetMatrix)return console.warn("Cannot predict without providing training examples."),null;(0,o.keep)(e.trainDatasetMatrix);var c=e.getNumExamples();return(0,o.reshape)((0,o.matMul)((0,o.reshape)(e.trainDatasetMatrix,[c,n]),(0,o.reshape)(r,[n,1])),[c])}))},t.prototype.predictClass=function(t,e){return void 0===e&&(e=3),c(this,void 0,void 0,(function(){var a,s,r,n,l=this;return u(this,(function(i){switch(i.label){case 0:if(e<1)throw new Error("Please provide a positive integer k value to predictClass.");if(0===this.getNumExamples())throw new Error("You have not added any examples to the KNN classifier. Please add examples before calling predictClass.");return a=(0,o.tidy)((function(){return(0,o.cast)(l.similarities(t),"float32")})),s=Math.min(e,this.getNumExamples()),n=p,[4,a.data()];case 1:return r=n.apply(void 0,[i.sent(),s]).indices,a.dispose(),[2,this.calculateTopClass(r,s)]}}))}))},t.prototype.clearClass=function(t){if(null==this.classDatasetMatrices[t])throw new Error("Cannot clear invalid class ".concat(t));this.classDatasetMatrices[t].dispose(),delete this.classDatasetMatrices[t],delete this.classExampleCount[t],this.clearTrainDatasetMatrix()},t.prototype.clearAllClasses=function(){for(var t in this.classDatasetMatrices)this.clearClass(t)},t.prototype.getClassExampleCount=function(){return this.classExampleCount},t.prototype.getClassifierDataset=function(){return this.classDatasetMatrices},t.prototype.getNumClasses=function(){return Object.keys(this.classExampleCount).length},t.prototype.setClassifierDataset=function(t){for(var e in this.clearTrainDatasetMatrix(),this.classDatasetMatrices=t,t)this.classExampleCount[e]=t[e].shape[0]},t.prototype.calculateTopClass=function(t,e){var a,s={};if(null==t)return{classIndex:this.labelToClassId[a],label:a,confidences:s};var r={},n=0;for(var l in this.classDatasetMatrices)n+=this.classExampleCount[l],r[l]=n;var i={};for(var l in this.classDatasetMatrices)i[l]=0;for(var o=0;o<t.length;o++){var c=t[o];for(var l in this.classDatasetMatrices)if(c<r[l]){i[l]++;break}}var u=0;for(var l in this.classDatasetMatrices){var p=i[l]/e;p>u&&(u=p,a=l),s[l]=p}return{classIndex:this.labelToClassId[a],label:a,confidences:s}},t.prototype.clearTrainDatasetMatrix=function(){null!=this.trainDatasetMatrix&&(this.trainDatasetMatrix.dispose(),this.trainDatasetMatrix=null)},t.prototype.normalizeVectorToUnitLength=function(t){return(0,o.tidy)((function(){var e=(0,o.norm)(t);return(0,o.div)(t,e)}))},t.prototype.getNumExamples=function(){var t=0;for(var e in this.classDatasetMatrices)t+=this.classExampleCount[e];return t},t.prototype.dispose=function(){for(var t in this.clearTrainDatasetMatrix(),this.classDatasetMatrices)this.classDatasetMatrices[t].dispose()},t}();const f=Object.freeze(["up","down","left","right"]);let d=function(t){function e(e){var a;return(a=t.call(this,e)||this).state={alertMessage:null,result:null,loading:!1},a.init=async()=>{a.setState({loading:!0}),await l.Cd_(),a.webcam=await l.aTG.webcam(a.elementVideo),a.model=await i.z(),a.classifier=new h,a.setState({loading:!1})},a.captureSample=async t=>{a.setState({loading:!0,alertMessage:null});try{const e=await a.webcam.capture(),s=a.model.infer(e,"conv_preds");a.classifier.addExample(s,t),e.dispose(),a.setState({loading:!1})}catch(e){a.setState({loading:!1,alertMessage:e.message||e})}},a.onClickPredict=async t=>{if(a.classifier.getNumClasses()>0){a.setState({loading:!0,result:null,alertMessage:null});try{const t=await a.webcam.capture(),e=a.model.infer(t,"conv_preds"),s=await a.classifier.predictClass(e);a.setState({loading:!1,result:s})}catch(e){a.setState({loading:!1,alertMessage:e.message||e})}}},a.elementVideo=r.createRef(),a.webcam=null,a.model=null,a.classifier=null,a}(0,s.Z)(e,t);var a=e.prototype;return a.componentDidMount=function(){this.init()},a.render=function(){return r.createElement(n.Z,{className:"my-4 d-flex flex-column align-items-center"},this.state.alertMessage&&r.createElement("span",{className:"alert alert-danger w-100"},this.state.alertMessage),r.createElement("video",{ref:t=>this.elementVideo=t,className:"border my-3"}),this.state.loading&&r.createElement("progress",null),!this.state.loading&&r.createElement(r.Fragment,null,r.createElement("section",{className:"w-100 d-flex justify-content-around my-4"},f.map(((t,e)=>r.createElement("button",{className:"btn btn-info",onClick:t=>this.captureSample(e)},t)))),r.createElement("button",{className:"btn btn-primary mt-5",onClick:this.onClickPredict},"Predict")),this.state.result&&r.createElement(r.Fragment,null,r.createElement("h2",null,"Result"),r.createElement("article",null,r.createElement("strong",null,"Prediction"),": ",f[this.state.result.label]),r.createElement("article",null,r.createElement("strong",null,"Probability"),": ",Math.round(100*this.state.result.confidences[this.state.result.label]),"%")))},e}(r.Component)}}]);
//# sourceMappingURL=component---src-pages-transfer-learning-jsx-8b8eabdcf43fe261cfea.js.map